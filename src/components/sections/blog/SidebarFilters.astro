---
// SidebarFilters.astro
// Sidebar profesional para búsqueda y filtrado de posts del blog
// NOTA: Este componente es puramente de presentación. La lógica de filtrado y estado debe manejarse en el padre (página o componente React/Preact).
// Props esperados:
// - query: string
// - selectedCategory: string
// - selectedTags: string[]
// - categories: string[]
// - tags: string[]
// - onFilterChange: (filters: { query: string; category: string; tags: string[] }) => void
// - onClear: () => void
// - latestPosts: Post[]

import { services, type Service } from '@lib/constants/services';

const { query, selectedCategory, selectedTags, categories, tags, latestPosts } =
  Astro.props as {
    query: string;
    selectedCategory: string;
    selectedTags: string[];
    categories: string[];
    tags: string[];
    latestPosts: any[];
  };

// Servicios destacados para el sidebar
const cornerstoneSlugs = [
  'diseno-desarrollo-web',
  'posicionamiento-seo',
  'publicidad-online-ia',
];

const featuredServices = services.filter((s: Service) =>
  cornerstoneSlugs.some((slug) => s.link.endsWith(slug))
);
---

<aside
  class="w-full max-w-xs bg-white dark:bg-gray-800 rounded-lg shadow p-8 mb-8 sticky top-8 z-10 ml-4"
>
  <form method="get" action="/blog" class="space-y-6">
    <div>
      <label
        for="search"
        class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"
        >Buscar</label
      >
      <input
        id="search"
        type="text"
        name="q"
        value={query}
        placeholder="Buscar por título, resumen..."
        class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:text-white dark:border-gray-600"
        autocomplete="off"
      />
    </div>
    <div>
      <span
        class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"
        >Categoría</span
      >
      <div class="space-y-1">
        <label class="flex items-center gap-2">
          <input
            type="radio"
            name="category"
            value=""
            checked={selectedCategory === ''}
          />
          Todas
        </label>
        {
          categories &&
            categories.length > 0 &&
            categories.map((cat: string) => (
              <label class="flex items-center gap-2">
                <input
                  type="radio"
                  name="category"
                  value={cat}
                  checked={selectedCategory === cat}
                />
                {cat}
              </label>
            ))
        }
      </div>
    </div>
    <div class="flex gap-2">
      <button
        type="submit"
        class="w-full py-2 px-4 bg-primary-600 text-white rounded hover:bg-primary-700 transition"
      >
        Buscar
      </button>
      <a
        href="/blog"
        class="w-full py-2 px-4 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-center transition"
      >
        Limpiar
      </a>
    </div>
  </form>
  <hr class="my-6 border-gray-200 dark:border-gray-700" />
  <section>
    <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">
      Últimos artículos
    </h3>
    <ul class="space-y-3">
      {
        latestPosts && latestPosts.length > 0 ? (
          latestPosts.map((post: any) => (
            <li>
              <a
                href={`/blog/${post.data.slug}`}
                class="flex items-center space-x-3 group"
              >
                {/* Imagen de cover */}
                <div class="flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden">
                  <img
                    src={post.data.cover}
                    alt={post.data.title}
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-200"
                  />
                </div>
                {/* Contenido del artículo */}
                <div class="flex-1 min-w-0">
                  <h4 class="text-primary-700 dark:text-primary-400 hover:text-primary transition-colors font-medium text-sm line-clamp-2">
                    {post.data.title}
                  </h4>
                  <span class="block text-xs text-gray-400 dark:text-gray-500">
                    {post.data.pubDate?.toLocaleDateString?.() ?? ''}
                  </span>
                </div>
              </a>
            </li>
          ))
        ) : (
          <li class="text-gray-400 text-sm">No hay artículos recientes.</li>
        )
      }
    </ul>
  </section>

  {/* Servicios destacados */}
  <hr class="my-6 border-gray-200 dark:border-gray-700" />
  <section>
    <h3 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">
      Servicios Destacados
    </h3>
    <div class="space-y-4">
      {
        featuredServices.map((service: Service) => (
          <div class="flex items-center space-x-3">
            {/* Icono cuadrado redondeado */}
            <a
              href={service.link}
              class="flex-shrink-0 w-12 h-12 rounded-lg bg-gray-100 dark:bg-gray-700 flex items-center justify-center hover:bg-primary-100 dark:hover:bg-primary-900 transition-colors"
            >
              <img
                src={
                  typeof service.icon === 'string'
                    ? service.icon
                    : service.icon.src
                }
                alt={service.alt}
                width="24"
                height="24"
                class="w-6 h-6 object-contain"
              />
            </a>
            {/* Nombre del servicio */}
            <a
              href={service.link}
              class="text-sm font-medium text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400 transition-colors flex-1"
            >
              {service.title}
            </a>
          </div>
        ))
      }
    </div>
  </section>
</aside>

<style>
  aside {
    min-width: 220px;
  }
  @media (max-width: 1024px) {
    aside {
      position: static;
      max-width: 100%;
      margin-bottom: 2rem;
    }
  }
  /* Estilos para truncar texto en múltiples líneas */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
