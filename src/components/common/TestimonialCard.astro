---
import { Image } from 'astro:assets';

export interface Props {
  testimonial: {
    id: number;
    quote: string;
    author: string;
    image: string;
    position: string;
    company: string;
    imageType?: string;
  };
}
const { testimonial } = Astro.props;
---

<figure
  class="bg-white rounded-lg shadow-xl border border-gray-200 p-8 flex flex-col items-center text-center h-full"
>
  <script type="application/ld+json">
    {JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Review",
      "reviewBody": testimonial.quote,
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": 5,
        "bestRating": 5,
        "worstRating": 1
      },
      "author": {
        "@type": "Person",
        "name": testimonial.author
      },
      "itemReviewed": {
        "@type": "Organization",
        "name": testimonial.company
      }
    })}
  </script>
  {(() => {
    const type = testimonial.imageType || 'avatar';
    if (type === 'avatar') {
      return (
        <img
          src={testimonial.image}
          alt={testimonial.author || "Foto de cliente"}
          class="w-20 h-20 mb-4 rounded-full object-cover"
          loading="lazy"
          width="80"
          height="80"
        />
      );
    } else if (type === 'logo') {
      return (
        <img
          src={testimonial.image}
          alt={testimonial.company || "Logo de empresa"}
          class="w-32 h-16 mb-4 rounded-none object-contain bg-white"
          loading="lazy"
          width="128"
          height="64"
        />
      );
    } else if (type === 'icono') {
      return (
        <img
          src={testimonial.image}
          alt={testimonial.company || "Icono de empresa"}
          class="w-20 h-20 mb-4 rounded-lg object-contain bg-white"
          loading="lazy"
          width="80"
          height="80"
        />
      );
    }
  })()}
  <blockquote class="text-lg italic text-gray-700 mb-4">
    “{testimonial.quote}”
  </blockquote>
  <figcaption class="text-gray-900 font-semibold">
    {testimonial.author}
  </figcaption>
  <div class="text-gray-500 text-sm">
    {testimonial.position} - {testimonial.company}
  </div>
</figure>
