---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

export interface Props {
  src: ImageMetadata | string;
  alt: string;
  width?: number;
  height?: number;
  class?: string;
  priority?: boolean;
  caption?: string;
}

const {
  src,
  alt,
  width = 800,
  height = 600,
  class: className = '',
  priority = false,
  caption,
} = Astro.props;

// Determinar si es una imagen local o externa
const isLocalImage = typeof src === 'object' && 'src' in src;
---

<figure class="my-8">
  {
    isLocalImage ? (
      <Image
        src={src as ImageMetadata}
        alt={alt}
        width={width}
        height={height}
        class={`w-full h-auto rounded-lg shadow-lg ${className}`}
        loading={priority ? 'eager' : 'lazy'}
        placeholder="blur"
        format="webp"
        quality={80}
        sizes="(max-width: 768px) 100vw, (max-width: 1200px) 80vw, 800px"
      />
    ) : (
      <img
        src={src as string}
        alt={alt}
        width={width}
        height={height}
        class={`w-full h-auto rounded-lg shadow-lg ${className}`}
        loading={priority ? 'eager' : 'lazy'}
        decoding="async"
      />
    )
  }
  {
    caption && (
      <figcaption class="mt-2 text-sm text-gray-600 text-center italic">
        {caption}
      </figcaption>
    )
  }
</figure>

