---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

export interface Props {
  src: ImageMetadata | string;
  alt: string;
  width?: number;
  height?: number;
  class?: string;
  sizes?: string;
  priority?: boolean;
  placeholder?: 'blur' | 'dominant-color' | 'none';
  format?: 'webp' | 'avif' | 'jpeg' | 'png';
  quality?: number;
}

const {
  src,
  alt,
  width = 800,
  height = 600,
  class: className = '',
  sizes = '(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw',
  priority = false,
  placeholder = 'blur',
  format = 'webp',
  quality = 80,
} = Astro.props;

// Determinar si es una imagen local o externa
const isLocalImage = typeof src === 'object' && 'src' in src;
const imageSrc = isLocalImage ? src : { src: src as string, width, height };
---

{
  isLocalImage ? (
    <Image
      src={src as ImageMetadata}
      alt={alt}
      width={width}
      height={height}
      class={className}
      sizes={sizes}
      loading={priority ? 'eager' : 'lazy'}
      placeholder={placeholder}
      format={format}
      quality={quality}
    />
  ) : (
    <img
      src={src as string}
      alt={alt}
      width={width}
      height={height}
      class={className}
      loading={priority ? 'eager' : 'lazy'}
      decoding="async"
      style="aspect-ratio: auto;"
    />
  )
}

